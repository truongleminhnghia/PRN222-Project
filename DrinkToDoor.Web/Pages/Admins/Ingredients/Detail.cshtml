@page
@model DrinkToDoor.Web.Pages.Admins.Ingredients.Detail
@using DrinkToDoor.Data.enums;
@using System.Globalization
@{
    ViewData["Title"] = "Chi tiết nguyên liệu";
    Layout = "_LayoutAdmin";
}

@section Styles {
    <style>
        .text-14 { font-size: 14px; line-height: 1.5; font-weight: 400; }
        .text-16 { font-size: 16px; line-height: 1.5; font-weight: 400; }
        .text-18 { font-size: 18px; line-height: 1.5; font-weight: 500; }
        .text-20 { font-size: 20px; line-height: 1.5; font-weight: 600; }
        .text-24 { font-size: 24px; line-height: 1.5; font-weight: 600; }
        .pl-8 { padding-left: 8px; }
        .pl-16 { padding-left: 16px; }
        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            filter: brightness(0);
        }
        .thumb {
            width: 80px;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
            transition: transform .2s;
        }
        .thumb.active {
            border: 2px solid #0d6efd;
            transform: scale(1.1);
        }
    </style>
}

<div class="container-xxxl mt-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb bg-transparent px-0">
      <li class="breadcrumb-item"><a href="/Admins/Ingredients/Index">Nguyên liệu</a></li>
      <li class="breadcrumb-item active" aria-current="page">@Model.IngredientResponse.Code</li>
    </ol>
  </nav>

  <div class="shadow-sm bg-white rounded mb-5 p-4">
    <h2 class="text-24 text-primary fw-bold mb-4">Thông tin chung</h2>
    <div class="row gx-4 gy-3 align-items-start">
      <div class="col-lg-7">
        <div id="ingredientCarousel" class="carousel slide mb-3" data-bs-ride="carousel">
          <div class="carousel-inner rounded overflow-hidden">
            @foreach (var (img, idx) in Model.IngredientResponse.Images.Select((img, idx) => (img, idx))) {
              <div class="carousel-item @(idx == 0 ? "active" : "")">
                <img src="@img.Url" class="d-block mx-auto" style="height: 450px;width: auto; object-fit: cover;" alt="Slide @idx" />
              </div>
            }
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#ingredientCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#ingredientCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
        <div class="d-flex justify-content-center gap-2" id="thumbnailContainer">
          @foreach (var (img, idx) in Model.IngredientResponse.Images.Select((img, idx) => (img, idx))) {
            <img src="@img.Url" class="img-thumbnail thumb @(idx == 0 ? "active" : "")" data-bs-target="#ingredientCarousel" data-bs-slide-to="@idx" />
          }
        </div>
      </div>

      <div class="col-lg-5">
        <div class="bg-light rounded p-4 h-100">
          <h3 class="text-24 fw-bold text-primary mb-3">@Model.IngredientResponse.Name</h3>
          <div class="row mb-3">
            <div class="col-6">
              <div class="text-16 text-muted">Mã nguyên liệu</div>
              <div class="text-18 fw-bold text-primary">@Model.IngredientResponse.Code</div>
            </div>
            <div class="col-6">
              <div class="text-16 text-muted">Số lượng tồn kho</div>
              <div class="text-18 fw-bold">@Model.IngredientResponse.StockQty</div>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-6">
              <div class="text-16 text-muted">Giá bán</div>
              <div class="text-18 fw-bold text-success">@Model.IngredientResponse.Price VNĐ</div>
            </div>
            <div class="col-6">
              <div class="text-16 text-muted">Giá nhập</div>
              <div class="text-18 fw-bold text-secondary">@Model.IngredientResponse.Cost VNĐ</div>
            </div>
          </div>
          <div class="row mb-4">
            <div class="col-6">
              <div class="text-16 text-muted">Nhà sản xuất</div>
              <div class="text-18">@Model.IngredientResponse.Supplier.Name</div>
            </div>
            <div class="col-6">
              <div class="text-16 text-muted">Loại sản phẩm</div>
              <div class="text-18">@Model.IngredientResponse.Category.Name</div>
            </div>
          </div>
          <div class="d-flex justify-content-between align-items-center">
            <span class="text-16">Trạng thái</span>
            <span class="badge @(Model.IngredientResponse.Status == EnumStatus.ACTIVE ? "bg-success" : "bg-secondary") text-14 fw-semibold py-2 px-3">
              @(Model.IngredientResponse.Status == EnumStatus.ACTIVE ? "Đang hoạt động" : "Ngừng hoạt động")
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="shadow-sm bg-white rounded mb-5 p-4">
    <h2 class="text-24 text-primary fw-bold mb-4">Thông tin chi tiết</h2>
    <div class="row gx-4 gy-4">
      <div class="col-md-8">
        <div class="card h-100">
          <div class="card-header bg-light">
            <h4 class="text-18 mb-0">Mô tả</h4>
          </div>
          <div class="card-body overflow-auto" style="max-height: 300px;">
            <p class="text-16">@Model.IngredientResponse.Description</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card mb-3">
          <div class="card-header bg-light">
            <h4 class="text-18 mb-0">Loại sản phẩm</h4>
          </div>
          <div class="card-body">
            <p class="text-16 fw-bold">@Model.IngredientResponse.Category.Name</p>
            <p class="text-14 text-muted">@Model.IngredientResponse.Category.CategoryType</p>
          </div>
        </div>
        <div class="card">
          <div class="card-header bg-light">
            <h4 class="text-18 mb-0">Nhà sản xuất</h4>
          </div>
          <div class="card-body">
            <p class="text-16 fw-bold">@Model.IngredientResponse.Supplier.Name</p>
            <p class="text-14 text-muted">@Model.IngredientResponse.Supplier.ContactPerson</p>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-5">
      <h4 class="text-20 fw-bold mb-3">Hình thức đóng gói</h4>
      <div class="row gx-3 gy-3">
        @foreach (var pack in Model.IngredientResponse.PackagingOptions) {
          <div class="col-sm-6 col-md-3">
            <div class="card h-100">
              <div class="card-body">
                <h5 class="text-16 fw-semibold mb-2">@pack.Label</h5>
                <p class="text-14 mb-1"><strong>Khối lượng:</strong> @pack.Size</p>
                <p class="text-14 mb-1"><strong>Số lượng tồn:</strong> @pack.StockQty</p>
                <p class="text-14 mb-0"><strong>Dạng:</strong> @pack.Type</p>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>

@section Scripts {
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const carouselEl = document.getElementById('ingredientCarousel');
      const thumbs = document.querySelectorAll('#thumbnailContainer .thumb');
      carouselEl.addEventListener('slid.bs.carousel', e => {
        thumbs.forEach(t => t.classList.remove('active'));
        thumbs[e.to].classList.add('active');
      });
      thumbs.forEach((thumb, idx) => thumb.addEventListener('click', () => bootstrap.Carousel.getInstance(carouselEl).to(idx)));
    });
  </script>
}
